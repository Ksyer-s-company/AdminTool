<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>frp 内网穿透配置方法</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><p data-anchor-id="mybo">20201025213215 <br>
​</p><div class="md-section-divider"></div><h1 data-anchor-id="663y" id="frp-内网穿透配置方法">frp 内网穿透配置方法</h1><p data-anchor-id="ft22">​</p><div class="md-section-divider"></div><h2 data-anchor-id="w2u4" id="运行原理">运行原理</h2><p data-anchor-id="44lc">​ <br>
frp 包含两个组件，frps (server) 和 frpc (client)，运行原理如下： <br>
​ <br>
User → 公网 frps (server) → 内网 frpc (client) <br>
​</p><div class="md-section-divider"></div><h2 data-anchor-id="oyw6" id="配置">配置</h2><p data-anchor-id="i8xq">​</p><div class="md-section-divider"></div><h3 data-anchor-id="z2bm" id="环境配置">环境配置</h3><p data-anchor-id="yqnf">​ <br>
配置 frp 需要安装 make 和 golang。以 ubuntu 为例： <br>
​ <br>
* 安装 make:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="piv8" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">sudo apt install make</span></code></li></ol></pre><p data-anchor-id="thry">​ <br>
* 安装 golang:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="skk0" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">sudo add</span><span class="pun">-</span><span class="pln">apt</span><span class="pun">-</span><span class="pln">repository ppa</span><span class="pun">:</span><span class="pln">longsleep</span><span class="pun">/</span><span class="pln">golang</span><span class="pun">-</span><span class="pln">backports</span></code></li><li class="L1"><code class="language-bash"><span class="pln">sudo apt update </span><span class="pun">&amp;&amp;</span><span class="pln"> apt install golang</span><span class="pun">-</span><span class="pln">go</span></code></li></ol></pre><p data-anchor-id="7ahg">​ <br>
* (应对中国特色情况) 配置 go 加速镜像</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="hzma" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="com"># 启用 Go Modules 功能</span></code></li><li class="L1"><code class="language-bash"><span class="pln">go env </span><span class="pun">-</span><span class="pln">w GO111MODULE</span><span class="pun">=</span><span class="pln">on</span></code></li><li class="L2"><code class="language-bash"><span class="com"># 1. 七牛 CDN</span></code></li><li class="L3"><code class="language-bash"><span class="pln">go env </span><span class="pun">-</span><span class="pln">w  GOPROXY</span><span class="pun">=</span><span class="pln">https</span><span class="pun">://</span><span class="pln">goproxy</span><span class="pun">.</span><span class="pln">cn</span><span class="pun">,</span><span class="pln">direct</span></code></li></ol></pre><p data-anchor-id="hhxh">​</p><div class="md-section-divider"></div><h3 data-anchor-id="b7dw" id="安装-frp">安装 frp</h3><p data-anchor-id="oro9">​ <br>
* 获取 frp 源码并构建</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="6grs" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">git clone https</span><span class="pun">://</span><span class="pln">github</span><span class="pun">.</span><span class="pln">com</span><span class="pun">/</span><span class="pln">fatedier</span><span class="pun">/</span><span class="pln">frp</span><span class="pun">.</span><span class="pln">git</span></code></li><li class="L1"><code class="language-bash"><span class="pln">cd frp</span></code></li><li class="L2"><code class="language-bash"><span class="pln">make</span></code></li></ol></pre><p data-anchor-id="bsjq">​</p><div class="md-section-divider"></div><h3 data-anchor-id="gwfq" id="使用-frp">使用 frp</h3><p data-anchor-id="5ar0">​ <br>
以 ssh 内网穿透为例： <br>
​</p><div class="md-section-divider"></div><h4 data-anchor-id="6mh3" id="server">Server</h4><p data-anchor-id="nsip">​ <br>
* 编辑配置文件 <code>frp/conf/frps.ini</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="11a9" style=""><ol class="linenums"><li class="L0"><code class="language-ini"><span class="pun">[</span><span class="pln">common</span><span class="pun">]</span></code></li><li class="L1"><code class="language-ini"><span class="pln">bind_port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">17333</span></code></li></ol></pre><p data-anchor-id="mv3i">​ <br>
* 运行 frps</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k74j" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pun">./</span><span class="pln">frp</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">frps </span><span class="pun">-</span><span class="pln">c frp</span><span class="pun">/</span><span class="pln">conf</span><span class="pun">/</span><span class="pln">frps</span><span class="pun">.</span><span class="pln">ini</span></code></li></ol></pre><p data-anchor-id="bb0f">​</p><div class="md-section-divider"></div><h4 data-anchor-id="h3gv" id="client">Client</h4><p data-anchor-id="0i15">​ <br>
* 编辑配置文件 <code>frp/conf/frpc.ini</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="wptz" style=""><ol class="linenums"><li class="L0"><code class="language-ini"><span class="pun">[</span><span class="pln">common</span><span class="pun">]</span></code></li><li class="L1"><code class="language-ini"><span class="pln">server_addr </span><span class="pun">=</span><span class="pln"> </span><span class="lit">207.148</span><span class="pun">.</span><span class="lit">104.84</span></code></li><li class="L2"><code class="language-ini"><span class="pln">server_port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">17333</span></code></li><li class="L3"><code class="language-ini"><span class="pun">​</span></code></li><li class="L4"><code class="language-ini"><span class="pun">[</span><span class="pln">ssh</span><span class="pun">]</span></code></li><li class="L5"><code class="language-ini"><span class="pln">type </span><span class="pun">=</span><span class="pln"> tcp</span></code></li><li class="L6"><code class="language-ini"><span class="pln">local_ip </span><span class="pun">=</span><span class="pln"> </span><span class="lit">127.0</span><span class="pun">.</span><span class="lit">0.1</span></code></li><li class="L7"><code class="language-ini"><span class="pln">local_port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">22</span></code></li><li class="L8"><code class="language-ini"><span class="pln">remote_port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">16333</span></code></li></ol></pre><p data-anchor-id="pinq">​</p><div class="md-section-divider"></div><h4 data-anchor-id="prgm" id="user">User</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="wk7t" style=""><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">ssh yyli@207</span><span class="pun">.</span><span class="lit">148.104</span><span class="pun">.</span><span class="lit">84</span><span class="pln"> </span><span class="pun">-</span><span class="pln">p </span><span class="lit">16333</span></code></li></ol></pre><p data-anchor-id="6cz1">（注：以上例子中 17333 是 frps 和 frpc 之间通信的端口；User 发出的访问的流向是 user -&gt; server:16333 -&gt; client:22 ） <br>
​ <br>
（更多配置方法 e.g. http 参见 GitHub 页面 <a href="https://github.com/fatedier/frp" target="_blank">https://github.com/fatedier/frp</a> ） <br>
​</p><div class="md-section-divider"></div><h3 data-anchor-id="8ysi" id="部署">部署</h3><p data-anchor-id="vabe">​ <br>
现在采用的是通过 <code>screen</code> 运行的方式。 <br>
​ <br>
<code>192.168.50.31</code> 是 frpc， <code>207.148.104.84</code> 是 frps。 <br>
​ <br>
通过 <code>screen -ls</code> 可以看到正在运行的 <code>screen</code> 。 <br>
​ <br>
通过 <code>screen -r frp</code> 可以链接到正在运行 frp 的终端。 <br>
​</p><div class="md-section-divider"></div><h3 data-anchor-id="720w" id="服务器">服务器</h3><p data-anchor-id="1uup">​ <br>
阿里云（国内）： <br>
39.105.184.90</p></div>
</body>
</html>